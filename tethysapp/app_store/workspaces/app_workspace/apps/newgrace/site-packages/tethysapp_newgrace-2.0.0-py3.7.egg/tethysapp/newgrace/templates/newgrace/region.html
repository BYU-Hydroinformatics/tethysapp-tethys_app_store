{% extends "newgrace/base.html" %}
{% load tethys_gizmos %}
{% load staticfiles %}

{% block header_buttons %}
 <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="Help">
    <a data-toggle="modal" data-target="#help-modal"><span class="glyphicon glyphicon-question-sign"></span></a>
  </div>
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="API">
    <a data-toggle="modal" data-target="#api-modal"><span class="glyphicon glyphicon-info-sign"></span></a>
  </div>
  <div class="header-button glyphicon-button" data-toggle="tooltip" data-placement="bottom" title="Home">
    <a href="{% url 'newgrace:home' %}"><span class="glyphicon glyphicon-home"></span></a>
  </div>
{% endblock %}

{% block styles %}
{{ block.super }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" />
<link rel="stylesheet" href="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.control.min.css" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw-src.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" />
<link rel="stylesheet" href="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.control.min.css" />

{% endblock %}

{% block global_scripts %}
{{block.super}}
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/nezasa/iso8601-js-period/master/iso8601.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.2/leaflet.draw-src.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/socib/Leaflet.TimeDimension/master/dist/leaflet.timedimension.min.js"></script>
    <script src="https://code.highcharts.com/stock/highstock.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
    <script src="https://highcharts.github.io/export-csv/export-csv.js"></script>
    <script src="https://code.highcharts.com/modules/no-data-to-display.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.4.2/Control.FullScreen.min.js"></script>

{% endblock %}

{% block app_content %}
  <html>
    <head>
        <title>GRACE Data Viewer</title>
    </head>
    <body>
    <script>window.onbeforeunload = null;</script>

        {% if regions_length > 1 %}
        <span class="reg_options" style="display: inline-block; white-space:nowrap; float:left; width:12%">
        <form action="{% url 'newgrace:region' %}" method="get">
                    <a name="submit-go-to-map" onchange="document.forms[0].submit();" id="submit-go-to-map" style="color:black;">
                        {% gizmo select_input select_region %}
                    </a>
        </form>
        </span>
        {% if user.is_superuser or user.is_staff %}
        <span style="display: inline-block; white-space:nowrap; float:left; margin-left:7%;">
        <p class="help-block">
            <a href="{% url 'newgrace:add-region' %}">Add New Region</a>.</p></span>
        {% endif %}
        {% else %}
            <span class="alert alert-warning" style="display: inline-block; white-space:nowrap; float:left;" role="alert">Sorry. There appear to be no other regions.
        {% if user.is_superuser or user.is_staff %}
        <span><p>To add one click <a href="{% url 'newgrace:add-region' %}">here.</a></p></span>
        {% endif %}
        </span>
        {% endif %}

        <span class="leg_min_max" style="white-space:nowrap; float:right; margin-left:0px;">
                Select Symbology:
                <select onchange=updateWMS() id="select_legend">
                        <option value="grace">Grace</option>
                        <option value="redblue">Red-blue</option>
                        <option value="rainbow">Rainbow</option>
                        <option value="occam">Occam</option>
                        <option value="ncview">ncview</option>
                        <option value="sst_36">sst_36</option>
                        <option value="greyscale">greyscale</option>
                        <option value="alg2">alg2</option>
                        <option value="occam_pastel-30">occam_pastel-30</option>
                        <option value="alg">alg</option>
                        <option value="ferret">ferret</option>
                </select>

                Min:
                    <input type="number" name="leg_min" id="col_min" min="-100" max="100" step="5" value="-25" onchange=updateWMS()>
                Max:
                    <input type="number" name="leg_max" id="col_max" min="-100" max="100" step="5" value="25" onchange=updateWMS()>
                Opacity:
                    <input type="number" name="opacity" id="opacity_val" min="0.1" max="1" step="0.1" value="0.7" onchange=updateWMS()>

        </span>
        <div id="map" style="height: 500px; width: 100%"></div>
        <div id="region" name="region" upper-name="{{display_name}}" data-map-center="{{map_center}}" data-wms-url="{{wms_url}}" data-bbox="{{bbox}}" region-area="{{region_area}}" lower_name="{{lower_name}}" thredds_wms="{{thredds_wms}}" style="display:none;"></div>
        <div id="regchart" style="width: 100%; height: 400px; "></div>
        <br>
        <div id="point-lat-lon"></div>
        <div align="center" class="flex-container-row"><img id="view-file-loading" class="view-file hidden" src="/static/newgrace/images/loader.gif" /></div>
        <div id="plotter"></div>
        <br>
        <br>
        <div id="test"></div>


    <script type="text/javascript" src="{% static 'newgrace/js/regionviewer.js' %}"></script>

    </body>
</html>

{% endblock %}

{# Use the after_app_content block for modals #}
{% block after_app_content %}
  <!-- Help Modal -->
<div class="modal fade" id="help-modal" tabindex="-1" role="dialog" aria-labelledby="help-modal-label">
    <div class="modal-dialog">
        <!--Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Guide</h4>
            </div>
            <div class="modal-body">
                <p><b>Subsetting of the regions is made possible through logic found in<a href="https://github.com/c-h-david/shbaam" target="_blank">SHBAAM</a> (Satellite Hydrology Bits Analysis And Mapping)</b></p>
                <!--<p><b>For any questions, comments or subsetting requests contact Dr. Norm Jones at <a href="mailto:njones@byu.edu">njones@byu.edu</a></b></p>-->
                <h5>The following steps highlight the several functions of the GRACE web app</h5>
                <ol>
                    <li class="welcome-step">Select a Region
                        <p><b>Click the "Select a Region" dropdown and select an option</b></p>
                        <p><b>Or simply select the Global Map tab from the navigation pane</b></p>
                    </li>
                    <li class="welcome-step">View different storage types
                        <p><b>You have four options to choose from:</b></p>
                        <ul>
                            <li class="welcome-substep1">Total Water Storage Anomaly(GRACE Data), Surface Water Storage Anomaly(derived from GLDAS Model), Soil Moisture Storage Anomaly(derived from GLDAS Model), Groundwater Storage Anomaly(Calculated/inferred using previously mentioned storage types).
                        </ul>
                    </li>
                    <li class="welcome-step">View different signal solutions
                        <p><b>You have four options to choose from:</b></p>
                        <ul>
                            <li class="welcome-substep1">JPL, CSR, GFZ, or an ensemble average of the three previously mentioned solutions.
                            <li class="welcome-substep1">Studies have shown that each of these solutions may prove to be more accurate in different locations in the world.  A citation of articles may be provided in the future for reference.
                        </ul>
                    </li>
                    <li class="welcome-step">View different timesteps
                        <p><b>You have two options to choose from:</b></p>
                        <ul>
                            <li class="welcome-substep1">Move the slider in the lower left-hand corner of the map
                            <li class="welcome-substep1">Select a date from the dropdown on the left
                        </ul>
                    </li>
                    <li class="welcome-step">View Animation
                        <ul>
                            <li class="welcome-substep1">Use the animation controls in the lower left-hand corner of the map to start or stop animation
                            <li class="welcome-substep1">Use the fps slider on the right side of the control bar to increase and decrease animation speed
                        </ul>
                    </li>
                    <li class="welcome-step">Contour/Map Settings
                        <ul>
                            <li class="welcome-substep1">Use the Select symbology dropdown to view different color schemes for the map contours.
                            <li class="welcome-substep1">Use the Max and Min toggles in the top left corner of the page to adjust the contour values.  The opacity toggle allows you to adjust the transparency of the map data layer
                        </ul>
                    </li>
                    <li class="welcome-step">View Time Series
                        <p><b>The Grace application allows the user to generate a time series plot for a specific location.  To generate a time series:</b></p>
                        <ul>
                            <li class="welcome-substep1">Click on the <b>Marker Icon</b> <span id= marker-icon class="glyphicon glyphicon-map-marker"></span> on the left side of the map, then place the marker within the data region.
                            <li class="welcome-substep1">The Time Series for that point will be generated below the map.
                        </ul>
                        <p>Note: You can also click anywhere on the time series graph to change the layer shown on the map to a specific time.  The time series can be exported in a number of formats by clicking the menu button on the chart(top-right).</p>
                    </li>
                    <li class="welcome-step">Click 'Exit' in the top-right of the app to return to the Main Apps Library</li>
                    <p>External Resources and Links:</p>
                    <p><a href="https://github.com/SarvaPulla/grace" target="_blank">View Code</a></p>
                    <p><a href="https://servirglobal.net/about-servir" target="_blank">About SERVIR</a></p>
                    <p><a href="https://servirglobal.net/Privacy-Terms-of-Use" target="_blank">Privacy and Terms of Conditions</a></p>
                </ol>
            </div>
            <div class="modal-footer">
                <div align="center" id="logos">
                    <div class="logo-image"><a href="http://www.usaid.gov/" target="_blank"><img src="https://servirglobal.net/Portals/_default/Skins/Servir2015/img/usaid.png"></a></div>
                    <div class="logo-image"><a href="http://appliedsciences.nasa.gov/" target="_blank"><img src="https://servirglobal.net/Portals/_default/Skins/Servir2015/img/nasa.png"></a></div>
                    <div class="logo-image"><a href="http://www.cilss.bf/" target="_blank"><img src="https://servirglobal.net/Portals/_default/Skins/Servir2015/img/cilss.png"></a></div>
                    <div class="logo-image"><a href="http://www.rcmrd.org/" target="_blank"><img src="https://servirglobal.net/Portals/_default/Skins/Servir2015/img/rcmrd.png"></a></div>
                    <div class="logo-image"><a href="http://www.icimod.org/" target="_blank"><img src="https://servirglobal.net/Portals/_default/Skins/Servir2015/img/icimod.png"></a></div>
                    <div class="logo-image"><a href="http://www.adpc.net/" target="_blank"><img src="https://servirglobal.net/Portals/_default/Skins/Servir2015/img/adpc.png"></a></div>
                </div>
            </div>


        </div>
    </div>
    <!--End modal content-->
</div>


<!-- API Modal -->
<div class="modal fade" id="api-modal" tabindex="-1" role="dialog" aria-labelledby="api-modal-label">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h2 class="modal-title" id="api-modal-label">Developers API</h2>
            </div>
            <div class="modal-body">
                <p>
                    A Developers API is provided for those who wish to incorporate the GRACE Tethys APP data into their own
                    separate application or script.
                </p>
                <br>
                <h3>API Methods</h3>
                <p>All API methods must be called using the following pattern:</p>
                <p><b>{{ host }}/apps/[parent-app]/api/[MethodName]/?param1=value1&#38;param2=value2&#38;...paramN=valueN</b></p>
                <p>See documentation and specific examples for all available methods below.</p>
                <br>
                <br>
                <h4>GetPointValues</h4>
                <table>
                    <tr>
                        <td><b>Parent App</b></td>
                        <td colspan="5">grace</td>
                    </tr>
                    <tr>
                        <th>Supported Methods</th>
                        <td colspan="5">GET</td>
                    </tr>
                    <tr>
                        <th>Returns</th>
                        <td colspan="5">A JSON object with a timeseries for a given point.</td>
                    </tr>
                    <tr>
                        <td rowspan="7"><b>Params</b></td>
                        <td><b>Name</b></td>
                        <td><b>Description</b></td>
                        <td><b>Valid Values</b></td>
                        <td><b>Required</b></td>
                    </tr>
                    <tr>
                        <td>latitude</td>
                        <td>Latitude in WGS 84 projection</td>
                        <td>Any value on land within the GRACE Explorer Domain (-60,90)</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>longitude</td>
                        <td>Longitude in the WGS 84 projection</td>
                        <td>Any value within the GRACE Explorer Domain (-180,180)</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>signal_solution</td>
                        <td>GRACE signal processing method</td>
                        <td>Use one of the following: (jpl, csr, gfz, avg)</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>storage_type</td>
                        <td>Storage type you wish to access</td>
                        <td>Use one of the following: (tot, sw, soil, gw)</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td>start_date</td>
                        <td>Start Date for the forecast</td>
                        <td>Any date after 2002 April 4</td>
                        <td>No</td>
                    </tr>
                    <tr>
                        <td>end_date</td>
                        <td>End Date of the Forecast</td>
                        <td>Any date after the start date</td>
                        <td>No</td>
                    </tr>

                </table>
                <h5>Example:</h5>
                <a href="{{ host }}/apps/newgrace/api/GetPointValues/?latitude=20.7&longitude=80.2&signal_solution=csr&storage_type=gw" target="_blank">
                    <code>{{ host }}/apps/newgrace/api/GetPointValues/?latitude=20.7&longitude=80.2&signal_solution=csr&storage_type=gw</code>
                </a>
            </div>
            <div class="modal-footer">
                <span><i>Developed at the BYU Hydroinformatics Lab</i></span>&nbsp;
                <a href="https://github.com/BYU-Hydroinformatics/lis" target="_blank" class="btn btn-default">View Code</a>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block app_navigation_items %}
    <h5>{{display_name}}</h5>



    <li {% if request.path == '/apps/newgrace/' %} class="active" {% endif %}><a href="{% url 'newgrace:home' %}">Home</a></li>

    <li {% if 'global-map' in request.path  %} class="active" {% endif %}><a href="{% url 'newgrace:global-map' %}">Global Map</a></li>

    <li {% if 'region' in request.path  %} class="active" {% endif %}><a style="cursor:pointer;">Regional Map</a></li>


    <br>

    {% gizmo select_input select_signal_process %}
    {% gizmo select_input select_storage_type %}
    {% gizmo select_input select_layer %}
    <br>
    <span style="white-space:nowrap; float:left;"><p style="font-size:14; color:black;"><b>Time Series Generator</b></p></span>
    <span style="white-space:nowrap; float:left; margin-left:2%; color:blue; cursor:pointer;" id= info-button onclick=getInstructions() class="glyphicon glyphicon-info-sign"></span>
    <br>
    <div id= "ts-instructions" class="time-series-instructions">
        <br><p>To generate a time series for a specific location, click on the <b>Marker Icon</b>
        <span id= marker-icon class="glyphicon glyphicon-map-marker"></span>
         on left side of the map.  Then place the marker at the location for which you wish to extract a time series from the current map layer.
        <br>
        <br>
        <b>***NOTE: The point time series will appear below the regional average time series plot.</b></p>
    </div>

{% endblock %}

{% block app_actions %}

{% endblock %}
